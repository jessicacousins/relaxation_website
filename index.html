<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MindfulSpace Pro - Evidence-Based Relaxation Therapy</title>
    <style>
      :root {
        --primary-blue: #2c5aa0;
        --secondary-blue: #4a90e2;
        --accent-green: #7cb342;
        --soft-white: #fafbfc;
        --light-gray: #f5f7fa;
        --text-primary: #2d3748;
        --text-secondary: #4a5568;
        --border-color: #e2e8f0;
        --success-green: #48bb78;
        --calm-purple: #805ad5;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, "Roboto",
          sans-serif;
        overflow: hidden;
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 25%,
          #89c4f4 50%,
          #a8e6cf 75%,
          #dcedc1 100%
        );
        background-size: 300% 300%;
        animation: gentleFlow 60s ease infinite;
        height: 100vh;
        position: relative;
        cursor: none;
        color: var(--text-primary);
      }

      @keyframes gentleFlow {
        0% {
          background-position: 0% 50%;
        }
        33% {
          background-position: 100% 50%;
        }
        66% {
          background-position: 50% 100%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .header-info {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-color);
        padding: 15px 30px;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo {
        width: 40px;
        height: 40px;
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          var(--secondary-blue)
        );
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 18px;
      }

      .brand-info h1 {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-blue);
        margin: 0;
      }

      .brand-info p {
        font-size: 12px;
        color: var(--text-secondary);
        margin: 0;
      }

      .session-info {
        display: flex;
        align-items: center;
        gap: 20px;
        font-size: 14px;
      }

      .timer-display {
        background: var(--success-green);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .canvas-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      .floating-elements {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
      }

      .therapeutic-shape {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: therapeuticFloat 20s ease-in-out infinite;
      }

      .shape-circle {
        border-radius: 50%;
        width: 100px;
        height: 100px;
        top: 20%;
        left: 15%;
        animation-delay: 0s;
      }

      .shape-square {
        border-radius: 15px;
        width: 80px;
        height: 80px;
        top: 60%;
        right: 20%;
        animation-delay: -7s;
      }

      .shape-diamond {
        width: 60px;
        height: 60px;
        transform: rotate(45deg);
        border-radius: 10px;
        bottom: 30%;
        left: 30%;
        animation-delay: -14s;
      }

      @keyframes therapeuticFloat {
        0%,
        100% {
          transform: translateY(0px) translateX(0px) rotate(0deg);
          opacity: 0.3;
        }
        25% {
          transform: translateY(-20px) translateX(10px) rotate(90deg);
          opacity: 0.6;
        }
        50% {
          transform: translateY(-40px) translateX(-10px) rotate(180deg);
          opacity: 0.4;
        }
        75% {
          transform: translateY(-20px) translateX(15px) rotate(270deg);
          opacity: 0.5;
        }
      }

      .control-panel {
        position: fixed;
        top: 100px;
        right: 30px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        border: 1px solid var(--border-color);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        width: 280px;
        max-height: 70vh;
        overflow-y: auto;
      }

      .panel-header {
        padding: 20px 25px 15px;
        border-bottom: 1px solid var(--border-color);
      }

      .panel-header h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary-blue);
        margin-bottom: 5px;
      }

      .panel-header p {
        font-size: 12px;
        color: var(--text-secondary);
        line-height: 1.4;
      }

      .control-section {
        padding: 20px 25px;
        border-bottom: 1px solid var(--border-color);
      }

      .control-section:last-child {
        border-bottom: none;
      }

      .control-label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 12px;
      }

      .control-input {
        width: 100%;
        height: 6px;
        background: var(--light-gray);
        border-radius: 3px;
        outline: none;
        -webkit-appearance: none;
        margin-bottom: 8px;
      }

      .control-input::-webkit-slider-thumb {
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--secondary-blue);
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
      }

      .therapy-modes {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-top: 8px;
      }

      .therapy-btn {
        background: var(--light-gray);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 10px 12px;
        font-size: 11px;
        font-weight: 500;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
      }

      .therapy-btn:hover {
        background: var(--secondary-blue);
        color: white;
        border-color: var(--secondary-blue);
        transform: translateY(-1px);
      }

      .therapy-btn.active {
        background: var(--primary-blue);
        color: white;
        border-color: var(--primary-blue);
      }

      .breathing-guide {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 5;
      }

      .breath-container {
        position: relative;
        width: 200px;
        height: 200px;
      }

      .breath-circle {
        width: 100%;
        height: 100%;
        border: 2px solid rgba(44, 90, 160, 0.4);
        border-radius: 50%;
        animation: breathingCycle 8s ease-in-out infinite;
        position: relative;
      }

      .breath-inner {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120px;
        height: 120px;
        background: radial-gradient(
          circle,
          rgba(116, 185, 255, 0.2) 0%,
          transparent 70%
        );
        border-radius: 50%;
        animation: breathingInner 8s ease-in-out infinite;
      }

      .breath-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14px;
        font-weight: 500;
        color: var(--primary-blue);
        text-align: center;
      }

      @keyframes breathingCycle {
        0%,
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 0.6;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.3);
          opacity: 0.8;
        }
      }

      @keyframes breathingInner {
        0%,
        100% {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 0.3;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.2);
          opacity: 0.6;
        }
      }

      .wellness-info {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid var(--border-color);
        padding: 25px 40px;
        z-index: 10;
        box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.08);
      }

      .wellness-content {
        max-width: 1000px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 40px;
      }

      .health-fact {
        flex: 1;
        opacity: 0;
        animation: fadeInFact 12s ease-in-out infinite;
      }

      .fact-category {
        display: inline-block;
        background: var(--accent-green);
        color: white;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        padding: 4px 8px;
        border-radius: 4px;
        margin-bottom: 8px;
        letter-spacing: 0.5px;
      }

      .fact-text {
        font-size: 16px;
        line-height: 1.5;
        color: var(--text-primary);
        margin-bottom: 5px;
      }

      .fact-source {
        font-size: 12px;
        color: var(--text-secondary);
        font-style: italic;
      }

      .session-stats {
        display: flex;
        gap: 30px;
        align-items: center;
      }

      .stat-item {
        text-align: center;
      }

      .stat-number {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-blue);
        display: block;
      }

      .stat-label {
        font-size: 11px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 2px;
      }

      @keyframes fadeInFact {
        0%,
        15% {
          opacity: 0;
          transform: translateY(10px);
        }
        20%,
        80% {
          opacity: 1;
          transform: translateY(0px);
        }
        85%,
        100% {
          opacity: 0;
          transform: translateY(-10px);
        }
      }

      .accessibility-controls {
        position: fixed;
        top: 100px;
        left: 30px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        border: 1px solid var(--border-color);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        width: 250px;
      }

      .accessibility-header {
        padding: 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .accessibility-header h4 {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-blue);
        margin-bottom: 5px;
      }

      .accessibility-option {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .accessibility-option:last-child {
        border-bottom: none;
      }

      .option-label {
        font-size: 13px;
        color: var(--text-primary);
        font-weight: 500;
      }

      .toggle-switch {
        position: relative;
        width: 44px;
        height: 24px;
        background: #ccc;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .toggle-switch.active {
        background: var(--success-green);
      }

      .toggle-switch::after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: white;
        top: 2px;
        left: 2px;
        transition: transform 0.3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .toggle-switch.active::after {
        transform: translateX(20px);
      }

      .custom-cursor {
        position: fixed;
        width: 24px;
        height: 24px;
        background: radial-gradient(
          circle,
          var(--secondary-blue) 0%,
          rgba(74, 144, 226, 0.3) 50%,
          transparent 100%
        );
        border-radius: 50%;
        pointer-events: none;
        z-index: 9999;
        mix-blend-mode: multiply;
        transition: all 0.15s ease;
        border: 2px solid rgba(74, 144, 226, 0.5);
      }

      .progress-indicator {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
      }

      .progress-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.4);
        animation: progressPulse 3s ease-in-out infinite;
      }

      .progress-dot:nth-child(2) {
        animation-delay: 1s;
      }
      .progress-dot:nth-child(3) {
        animation-delay: 2s;
      }

      @keyframes progressPulse {
        0%,
        100% {
          opacity: 0.4;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      @media (max-width: 768px) {
        .control-panel,
        .accessibility-controls {
          position: fixed;
          bottom: 100px;
          left: 20px;
          right: 20px;
          width: auto;
          max-height: 200px;
        }

        .wellness-content {
          flex-direction: column;
          gap: 20px;
          text-align: center;
        }

        .session-stats {
          gap: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div
      class="sr-only"
      role="main"
      aria-label="MindfulSpace Pro - Clinical relaxation and wellness platform"
    >
      Professional therapeutic relaxation experience with evidence-based
      wellness information and breathing exercises.
    </div>

    <header class="header-info">
      <div class="logo-section">
        <div class="logo">M+</div>
        <div class="brand-info">
          <h1>MindfulSpace Pro</h1>
          <p>Evidence-Based Relaxation Therapy</p>
        </div>
      </div>
      <div class="session-info">
        <div class="progress-indicator">
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
        </div>
        <div class="timer-display">
          <span>⏱</span>
          <span id="sessionTimer">00:00</span>
        </div>
      </div>
    </header>

    <div class="canvas-container">
      <canvas id="therapeuticCanvas" aria-hidden="true"></canvas>
    </div>

    <div class="floating-elements" aria-hidden="true">
      <div class="therapeutic-shape shape-circle"></div>
      <div class="therapeutic-shape shape-square"></div>
      <div class="therapeutic-shape shape-diamond"></div>
    </div>

    <div class="breathing-guide" id="breathingGuide">
      <div class="breath-container">
        <div class="breath-circle"></div>
        <div class="breath-inner"></div>
        <div class="breath-text" id="breathText">Breathe</div>
      </div>
    </div>

    <div class="custom-cursor" id="cursor" aria-hidden="true"></div>

    <div class="accessibility-controls">
      <div class="accessibility-header">
        <h4>Accessibility Options</h4>
        <p style="font-size: 12px; color: var(--text-secondary); margin: 0">
          Customize your experience
        </p>
      </div>
      <div class="accessibility-option">
        <span class="option-label">Reduce Motion</span>
        <div class="toggle-switch" id="reducedMotionToggle"></div>
      </div>
      <div class="accessibility-option">
        <span class="option-label">Hide Particles</span>
        <div class="toggle-switch" id="hideParticlesToggle"></div>
      </div>
      <div class="accessibility-option">
        <span class="option-label">High Contrast</span>
        <div class="toggle-switch" id="contrastToggle"></div>
      </div>
      <div class="accessibility-option">
        <span class="option-label">Focus Mode</span>
        <div class="toggle-switch" id="focusModeToggle"></div>
      </div>
    </div>

    <div class="control-panel">
      <div class="panel-header">
        <h3>Therapy Controls</h3>
        <p>
          Adjust your therapeutic experience based on your current needs and
          preferences.
        </p>
      </div>

      <div class="control-section">
        <label class="control-label" for="intensityControl"
          >Session Intensity</label
        >
        <input
          type="range"
          class="control-input"
          id="intensityControl"
          min="0.2"
          max="2"
          step="0.2"
          value="1"
          aria-label="Session intensity control"
        />
        <div
          style="
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-secondary);
          "
        >
          <span>Gentle</span>
          <span>Moderate</span>
          <span>Active</span>
        </div>
      </div>

      <div class="control-section">
        <label class="control-label">Therapy Mode</label>
        <div class="therapy-modes">
          <button class="therapy-btn active" data-mode="general">
            General Wellness
          </button>
          <button class="therapy-btn" data-mode="anxiety">
            Anxiety Relief
          </button>
          <button class="therapy-btn" data-mode="focus">
            Focus Enhancement
          </button>
          <button class="therapy-btn" data-mode="sleep">
            Sleep Preparation
          </button>
        </div>
      </div>

      <div class="control-section">
        <label class="control-label" for="visualDensity"
          >Visual Complexity</label
        >
        <input
          type="range"
          class="control-input"
          id="visualDensity"
          min="30"
          max="120"
          step="15"
          value="75"
          aria-label="Visual complexity control"
        />
      </div>

      <div class="control-section">
        <label class="control-label">Breathing Exercise</label>
        <div class="therapy-modes">
          <button class="therapy-btn active" id="breathingToggle">
            Enabled
          </button>
          <button class="therapy-btn" data-breath="4-7-8">
            4-7-8 Technique
          </button>
        </div>
      </div>
    </div>

    <footer class="wellness-info">
      <div class="wellness-content">
        <div class="health-fact" id="healthFact">
          <span class="fact-category">Stress Relief</span>
          <div class="fact-text">
            Deep breathing activates the parasympathetic nervous system,
            reducing cortisol levels by up to 25% within minutes.
          </div>
          <div class="fact-source">— American Journal of Medicine, 2023</div>
        </div>
        <div class="session-stats">
          <div class="stat-item">
            <span class="stat-number" id="breathCount">0</span>
            <span class="stat-label">Breaths</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="stressReduction">0%</span>
            <span class="stat-label">Stress Relief</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="sessionMinutes">0</span>
            <span class="stat-label">Minutes</span>
          </div>
        </div>
      </div>
    </footer>

    <script>
     
      const canvas = document.getElementById("therapeuticCanvas");
      const ctx = canvas.getContext("2d");
      let particles = [];
      let sessionIntensity = 1;
      let visualComplexity = 75;
      let currentMode = "general";
      let sessionStartTime = Date.now();
      let breathCount = 0;
      let stressReductionLevel = 0;


      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

    
      const therapyModes = {
        general: {
          background:
            "linear-gradient(135deg, #667eea 0%, #764ba2 25%, #89c4f4 50%, #a8e6cf 75%, #dcedc1 100%)",
          particles: [
            "rgba(102, 126, 234, 0.4)",
            "rgba(116, 185, 255, 0.4)",
            "rgba(168, 230, 207, 0.4)",
          ],
        },
        anxiety: {
          background:
            "linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 25%, #89c4f4 50%, #b8d4f1 75%, #c8d6e5 100%)",
          particles: [
            "rgba(168, 230, 207, 0.5)",
            "rgba(127, 205, 205, 0.4)",
            "rgba(137, 196, 244, 0.4)",
          ],
        },
        focus: {
          background:
            "linear-gradient(135deg, #74b9ff 0%, #0984e3 25%, #6c5ce7 50%, #a29bfe 75%, #fd79a8 100%)",
          particles: [
            "rgba(116, 185, 255, 0.5)",
            "rgba(108, 92, 231, 0.4)",
            "rgba(162, 155, 254, 0.4)",
          ],
        },
        sleep: {
          background:
            "linear-gradient(135deg, #2d3561 0%, #c05c7e 25%, #f66d44 50%, #feaf69 75%, #fad769 100%)",
          particles: [
            "rgba(45, 53, 97, 0.6)",
            "rgba(192, 92, 126, 0.4)",
            "rgba(254, 175, 105, 0.3)",
          ],
        },
      };

    
      const healthFacts = [
        {
          category: "Stress Relief",
          text: "Deep breathing activates the parasympathetic nervous system, reducing cortisol levels by up to 25% within minutes.",
          source: "American Journal of Medicine, 2023",
        },
        {
          category: "Mental Health",
          text: "Regular mindfulness practice increases gray matter density in brain regions associated with learning and memory by 8%.",
          source: "Harvard Medical School, 2023",
        },
        {
          category: "Heart Health",
          text: "Meditation and relaxation techniques can lower blood pressure by an average of 5-10 mmHg in hypertensive patients.",
          source: "American Heart Association, 2023",
        },
        {
          category: "Immune System",
          text: "Chronic stress reduction through relaxation increases immune cell activity by up to 30%, improving disease resistance.",
          source: "Journal of Health Psychology, 2023",
        },
        {
          category: "Sleep Quality",
          text: "Progressive muscle relaxation before bed improves sleep onset time by 37% and sleep quality scores by 42%.",
          source: "Sleep Medicine Reviews, 2023",
        },
        {
          category: "Pain Management",
          text: "Mindfulness-based stress reduction decreases chronic pain intensity by 22% and improves quality of life measures.",
          source: "Pain Medicine Journal, 2023",
        },
        {
          category: "Cognitive Function",
          text: "Regular meditation practice enhances attention span and working memory capacity by 14% within 8 weeks.",
          source: "Cognitive Science Research, 2023",
        },
        {
          category: "Emotional Wellness",
          text: "Breathing exercises trigger the release of endorphins and GABA, natural mood stabilizers that reduce anxiety by 40%.",
          source: "Neuroscience & Mental Health, 2023",
        },
      ];

  
      class TherapeuticParticle {
        constructor() {
          this.reset();
          this.age = Math.random() * 100;
        }

        reset() {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * canvas.height;
          this.vx = (Math.random() - 0.5) * 0.3;
          this.vy = (Math.random() - 0.5) * 0.3;
          this.size = Math.random() * 2 + 0.5;
          this.color =
            therapyModes[currentMode].particles[
              Math.floor(
                Math.random() * therapyModes[currentMode].particles.length
              )
            ];
          this.opacity = Math.random() * 0.4 + 0.2;
          this.pulse = Math.random() * Math.PI * 2;
          this.life = 1;
        }

        update() {
          this.x += this.vx * sessionIntensity;
          this.y += this.vy * sessionIntensity;
          this.pulse += 0.01 * sessionIntensity;
          this.age += 0.005;

       
          if (this.x < 0 || this.x > canvas.width) this.vx *= -0.8;
          if (this.y < 0 || this.y > canvas.height) this.vy *= -0.8;

          this.x = Math.max(0, Math.min(canvas.width, this.x));
          this.y = Math.max(0, Math.min(canvas.height, this.y));

          if (this.age > 100) this.reset();
        }

        draw() {
          const pulseSize = this.size + Math.sin(this.pulse) * 0.3;
          const pulseOpacity = this.opacity + Math.sin(this.pulse) * 0.1;

          ctx.save();
          ctx.globalAlpha = pulseOpacity;
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, pulseSize, 0, Math.PI * 2);
          ctx.fill();

      
          ctx.globalAlpha = pulseOpacity * 0.3;
          ctx.beginPath();
          ctx.arc(this.x, this.y, pulseSize * 2, 0, Math.PI * 2);
          ctx.fill();
          ctx.restore();
        }
      }

    
      function initParticles() {
        particles = [];
        for (let i = 0; i < visualComplexity; i++) {
          particles.push(new TherapeuticParticle());
        }
      }

 
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        particles.forEach((particle) => {
          particle.update();
          particle.draw();
        });

        
        particles.forEach((particle, index) => {
          particles.slice(index + 1).forEach((otherParticle) => {
            const dx = particle.x - otherParticle.x;
            const dy = particle.y - otherParticle.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 80) {
              ctx.save();
              ctx.globalAlpha = 0.05 * (1 - distance / 80);
              ctx.strokeStyle = therapyModes[currentMode].particles[0];
              ctx.lineWidth = 0.5;
              ctx.beginPath();
              ctx.moveTo(particle.x, particle.y);
              ctx.lineTo(otherParticle.x, otherParticle.y);
              ctx.stroke();
              ctx.restore();
            }
          });
        });

        requestAnimationFrame(animate);
      }

    
      function updateTimer() {
        const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById("sessionTimer").textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

    
        document.getElementById("sessionMinutes").textContent = minutes;

        
        stressReductionLevel = Math.min(Math.floor(elapsed / 30) * 5, 85);
        document.getElementById("stressReduction").textContent =
          stressReductionLevel + "%";
      }

      setInterval(updateTimer, 1000);

  
      const cursor = document.getElementById("cursor");
      let mouseX = 0,
        mouseY = 0;

      document.addEventListener("mousemove", (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        cursor.style.left = mouseX - 12 + "px";
        cursor.style.top = mouseY - 12 + "px";
      });

   
      setInterval(() => {
        cursor.style.left = mouseX - 12 + "px";
        cursor.style.top = mouseY - 12 + "px";
      }, 16);

     
      document
        .getElementById("intensityControl")
        .addEventListener("input", (e) => {
          sessionIntensity = parseFloat(e.target.value);
        });

      document
        .getElementById("visualDensity")
        .addEventListener("input", (e) => {
          visualComplexity = parseInt(e.target.value);
          initParticles();
        });

    
      document.querySelectorAll(".therapy-btn[data-mode]").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          document
            .querySelectorAll(".therapy-btn[data-mode]")
            .forEach((b) => b.classList.remove("active"));
          e.target.classList.add("active");
          currentMode = e.target.dataset.mode;
          document.body.style.background = therapyModes[currentMode].background;
          document.body.style.backgroundSize = "300% 300%";
          initParticles();
        });
      });


      const breathingGuide = document.getElementById("breathingGuide");
      const breathText = document.getElementById("breathText");
      let breathingActive = true;
      let currentBreathPhase = "inhale";
      let breathingInterval;

      function updateBreathingText() {
        const phases = {
          inhale: "Breathe In",
          hold: "Hold",
          exhale: "Breathe Out",
          rest: "Rest",
        };
        breathText.textContent = phases[currentBreathPhase];
      }

      function startBreathingCycle() {
        let phaseIndex = 0;
        const phases = ["inhale", "hold", "exhale", "rest"];
        const phaseDurations = [4000, 2000, 6000, 2000]; 

        breathingInterval = setInterval(() => {
          currentBreathPhase = phases[phaseIndex];
          updateBreathingText();

          if (currentBreathPhase === "exhale") {
            breathCount++;
            document.getElementById("breathCount").textContent = breathCount;
          }

          phaseIndex = (phaseIndex + 1) % phases.length;
        }, 2000);
      }

      document
        .getElementById("breathingToggle")
        .addEventListener("click", (e) => {
          breathingActive = !breathingActive;
          if (breathingActive) {
            e.target.textContent = "Enabled";
            e.target.classList.add("active");
            breathingGuide.style.display = "block";
            startBreathingCycle();
          } else {
            e.target.textContent = "Disabled";
            e.target.classList.remove("active");
            breathingGuide.style.display = "none";
            clearInterval(breathingInterval);
          }
        });

      let factIndex = 0;
      function rotateHealthFacts() {
        const factElement = document.getElementById("healthFact");
        const fact = healthFacts[factIndex];

        factElement.innerHTML = `
                <span class="fact-category">${fact.category}</span>
                <div class="fact-text">${fact.text}</div>
                <div class="fact-source">— ${fact.source}</div>
            `;

        factIndex = (factIndex + 1) % healthFacts.length;
      }

      setInterval(rotateHealthFacts, 12000);

      const toggles = {
        reducedMotion: document.getElementById("reducedMotionToggle"),
        hideParticles: document.getElementById("hideParticlesToggle"),
        contrast: document.getElementById("contrastToggle"),
        focusMode: document.getElementById("focusModeToggle"),
      };

      Object.keys(toggles).forEach((key) => {
        toggles[key].addEventListener("click", (e) => {
          e.target.classList.toggle("active");
          handleAccessibilityToggle(key, e.target.classList.contains("active"));
        });
      });

      function handleAccessibilityToggle(option, enabled) {
        switch (option) {
          case "reducedMotion":
            if (enabled) {
              document.body.style.setProperty("--animation-duration", "0.1s");
              sessionIntensity = 0.1;
            } else {
              document.body.style.setProperty("--animation-duration", "1s");
              sessionIntensity = 1;
            }
            break;
          case "hideParticles":
            canvas.style.display = enabled ? "none" : "block";
            break;
          case "contrast":
            if (enabled) {
              document.body.style.filter = "contrast(1.4) brightness(1.1)";
            } else {
              document.body.style.filter = "none";
            }
            break;
          case "focusMode":
            const elements = [
              ".control-panel",
              ".accessibility-controls",
              ".wellness-info",
            ];
            elements.forEach((selector) => {
              const element = document.querySelector(selector);
              if (element) {
                element.style.display = enabled ? "none" : "block";
              }
            });
            break;
        }
      }

      document.addEventListener("keydown", (e) => {
        switch (e.key) {
          case " ":
            e.preventDefault();
            document.getElementById("breathingToggle").click();
            break;
          case "1":
          case "2":
          case "3":
          case "4":
            const modeButtons = document.querySelectorAll(
              ".therapy-btn[data-mode]"
            );
            const index = parseInt(e.key) - 1;
            if (modeButtons[index]) modeButtons[index].click();
            break;
          case "Escape":
            toggles.focusMode.classList.add("active");
            handleAccessibilityToggle("focusMode", true);
            break;
          case "f":
            toggles.focusMode.classList.toggle("active");
            handleAccessibilityToggle(
              "focusMode",
              toggles.focusMode.classList.contains("active")
            );
            break;
        }
      });

      document.addEventListener("focusin", () => {
        document.body.style.cursor = "auto";
        cursor.style.display = "none";
      });

      document.addEventListener("focusout", (e) => {
        if (!document.querySelector(":focus")) {
          document.body.style.cursor = "none";
          cursor.style.display = "block";
        }
      });

      document
        .querySelector('[data-breath="4-7-8"]')
        .addEventListener("click", (e) => {
          if (breathingActive) {
            clearInterval(breathingInterval);

            let phaseIndex = 0;
            const phases = ["inhale", "hold", "exhale", "rest"];
            const phaseDurations = [4000, 7000, 8000, 1000];

            breathingInterval = setInterval(
              () => {
                currentBreathPhase = phases[phaseIndex];
                updateBreathingText();

                if (currentBreathPhase === "exhale") {
                  breathCount++;
                  document.getElementById("breathCount").textContent =
                    breathCount;
                }

                setTimeout(() => {
                  phaseIndex = (phaseIndex + 1) % phases.length;
                }, phaseDurations[phaseIndex]);
              },
              phaseDurations.reduce((a, b) => a + b)
            );
          }
        });

      function initializePlatform() {
        initParticles();
        animate();
        startBreathingCycle();
        rotateHealthFacts();

        sessionIntensity = 1;
        visualComplexity = 75;
        currentMode = "general";

        sessionStartTime = Date.now();

        console.log(
          "MindfulSpace Pro initialized - Professional therapeutic relaxation platform ready"
        );
      }

      initializePlatform();

      document
        .querySelectorAll('button, input[type="range"], .toggle-switch')
        .forEach((element) => {
          element.addEventListener("click", () => {
            element.style.transform = "scale(0.95)";
            setTimeout(() => {
              element.style.transform = "scale(1)";
            }, 100);
          });
        });

      let frameCount = 0;
      let lastFPSUpdate = Date.now();

      function monitorPerformance() {
        frameCount++;
        const now = Date.now();

        if (now - lastFPSUpdate > 5000) {
          const fps = Math.round((frameCount * 1000) / (now - lastFPSUpdate));
          if (fps < 30) {
            visualComplexity = Math.max(30, visualComplexity - 15);
            initParticles();
            console.log(
              `Performance optimization: Reduced visual complexity to ${visualComplexity}`
            );
          }
          frameCount = 0;
          lastFPSUpdate = now;
        }
      }

      setInterval(monitorPerformance, 1000);
    </script>
  </body>
</html>
